<!-- XHTML 1.0 Strict -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<meta name="author" content="Rachid Touzani" />
<meta name="keywords" content=" css, dropdowns, dropdown menu, drop-down, menu, navigation, nav, horizontal, vertical left-to-right, vertical right-to-left, horizontal linear, horizontal upwards, cross browser, internet explorer, ie, firefox, safari, opera, browser, lwis" />
<meta name="description" content="Clean, standards-friendly, modular framework for dropdown menus" />
<link href="../css/dropdown.vertical.css" media="screen" rel="stylesheet" type="text/css" />
<link href="../css/default.ultimate.css" media="screen" rel="stylesheet" type="text/css" />

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Lesson 5</title>
<link rel="stylesheet" type="text/css" href="../doxygen.css" />
<link rel="stylesheet" type="text/css" href="../tabs.css"  />
</head>

<body bgcolor="#FFFFFF" link="#FF0000" vlink="#FF00FF" alink="#FF00FF">
<p align="center"><a href="../index.html"><img src="../im/ofeli.gif" width="150" border="0"></a></p>

<center>
  <div id="cse" style="width: 60%;">Loading</div>
  <script src="http://www.google.com/jsapi" type="text/javascript"></script>
  <script type="text/javascript"> 
     google.load('search', '1', {language : 'en', style : google.loader.themes.SHINY});
     google.setOnLoadCallback(function() {
        var customSearchOptions = {};  var customSearchControl = new google.search.CustomSearchControl(
        '012396140824982761142:-qrywxcfi_o', customSearchOptions);
        customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
        customSearchControl.draw('cse');
     }, true);
   </script>
   <style type="text/css">
     .gsc-control-cse {
     font-family: Verdana, sans-serif;
     border-color: #DAE0E5;
     background-color: #DAE0E5;
   }
   .gsc-control-cse .gsc-table-result { font-family: Verdana, sans-serif; }
   input.gsc-input { border-color: #B6BEC5; }
   input.gsc-search-button {
     border-color: #B6BEC5;
     background-color: #D0D1D4;
   }
   .gsc-tabHeader.gsc-tabhInactive {
     border-color: #999999;
     background-color: #EEEEEE;
   }
   .gsc-tabHeader.gsc-tabhActive {
     border-color: #999999;
     background-color: #999999;
   }
   .gsc-tabsArea { border-color: #999999; }
   .gsc-webResult.gsc-result,
   .gsc-results .gsc-imageResult {
     border-color: #FFFFFF;
     background-color: #FFFFFF;
   }
   .gsc-webResult.gsc-result:hover,
   .gsc-imageResult:hover {
     border-color: #D2D6DC;
     background-color: #EDEDED;
   }
   .gsc-webResult.gsc-result.gsc-promotion:hover {
     border-color: #D2D6DC;
     background-color: #EDEDED;
   }
   .gs-webResult.gs-result a.gs-title:link,
   .gs-webResult.gs-result a.gs-title:link b,
   .gs-imageResult a.gs-title:link,
   .gs-imageResult a.gs-title:link b { color: #0568CD; }
   .gs-webResult.gs-result a.gs-title:visited,
   .gs-webResult.gs-result a.gs-title:visited b,
   .gs-imageResult a.gs-title:visited,
   .gs-imageResult a.gs-title:visited b { color: #0568CD; }
   .gs-webResult.gs-result a.gs-title:hover,
   .gs-webResult.gs-result a.gs-title:hover b,
   .gs-imageResult a.gs-title:hover,
   .gs-imageResult a.gs-title:hover b { color: #0568CD; }
   .gs-webResult.gs-result a.gs-title:active,
   .gs-webResult.gs-result a.gs-title:active b,
   .gs-imageResult a.gs-title:active,
   .gs-imageResult a.gs-title:active b { color: #0568CD; }
   .gsc-cursor-page { color: #0568CD; }
   a.gsc-trailing-more-results:link { color: #0568CD; }
   .gs-webResult .gs-snippet,
   .gs-imageResult .gs-snippet,
   .gs-fileFormatType { color: #5F6A73; }
   .gs-webResult div.gs-visibleUrl,
   .gs-imageResult div.gs-visibleUrl { color: #5F6A73; }
   .gs-webResult div.gs-visibleUrl-short { color: #5F6A73; }
   .gs-webResult div.gs-visibleUrl-short { display: none; }
   .gs-webResult div.gs-visibleUrl-long { display: block; }
   .gs-promotion div.gs-visibleUrl-short { display: none; }
   .gs-promotion div.gs-visibleUrl-long { display: block; }
   .gsc-cursor-box { border-color: #FFFFFF; }
   .gsc-results .gsc-cursor-box .gsc-cursor-page {
      border-color: #999999;
      background-color: #FFFFFF;
      color: #0568CD;
   }
   .gsc-results .gsc-cursor-box .gsc-cursor-current-page {
      border-color: #999999;
      background-color: #999999;
      color: #0568CD;
   }
   .gsc-webResult.gsc-result.gsc-promotion {
      border-color: #D2D6DC;
      background-color: #D0D1D4;
   }
   .gsc-completion-title { color: #0568CD; }
   .gsc-completion-snippet { color: #5F6A73; }
   .gs-promotion a.gs-title:link,
   .gs-promotion a.gs-title:link *,
   .gs-promotion .gs-snippet a:link { color: #0066CC; }
   .gs-promotion a.gs-title:visited,
   .gs-promotion a.gs-title:visited *,
   .gs-promotion .gs-snippet a:visited { color: #0066CC; }
   .gs-promotion a.gs-title:hover,
   .gs-promotion a.gs-title:hover *,
   .gs-promotion .gs-snippet a:hover { color: #0066CC; }
   .gs-promotion a.gs-title:active,
   .gs-promotion a.gs-title:active *,
   .gs-promotion .gs-snippet a:active { color: #0066CC; }
   .gs-promotion .gs-snippet,
   .gs-promotion .gs-title .gs-promotion-title-right,
   .gs-promotion .gs-title .gs-promotion-title-right *  { color: #333333; }
   .gs-promotion .gs-visibleUrl,
   .gs-promotion .gs-visibleUrl-short { color: #5F6A73; }
   </style>
</center>
</p>

<div id="mainmenu">
<div class="text">

 <div class="tabs">
   <ul class="tablist">
   <li><a href="../index.html"><span>Home</span></a>
   <li><a href="../overview.html"><span>Overview</span></a>
   <li><a href="../html/index.html"><span>Class Documentation</span></a>
   <li><a href="../fformats.html"><span>File Formats</span></a>
   <li class="current"><a href="../tutorial.html"><span>Tutorial</span></a>
   <li><a href="../demos.html"><span>Demo Codes</span></a>
   </ul>
</div>

</div>
</div>

&nbsp;
<p>
<h2>Lesson 5: An Optimization Problem</h2>

<p><table border="2" cellpadding="2" cellspacing="0" >
<tr>
<td align="center" width="35"><a href="lesson4.html"><img src="../im/backward.gif" border="0"></a></td>
<td align="center" width="35"><a href="../tutorial.html"><img src="../im/top.gif" border="0"></a></td>
<td align="center" width="35"><a href="lesson6.html"><img src="../im/forward.gif" border="0"></a></td>
</tr>
</table>
</p>

<p>
<span class=TEXT>The present lesson demonstrates how to use an optimization problem solver. We solve the same
problem as in <a href="lesson2.html">Lesson 2</a> as an optimization problem where Dirichlet boundary conditions are
considered as equality constraints. The optimization algorithm is the Truncated Newton algorithm described in
function <a href="../html/OptimTN_8h.html">OptimTN</a>. This is not the best method to solve a Laplace equation, but our
purpose here is to learn how to use this class.

<p class=EL>The Finite Element Code</p>

<h4><span class:text><font color="red">The main program</font></span></h4>

<SPAN class=TEXT><SPAN class=TEXT>Here is a description of the source code.
The source file can be found in Example 5 in the <span class=VAR>examples</span> directory.</span>

<ul type="square">
<li><SPAN class=TEXT>We start, as usual, by including required headers and naming the appropriate namespace.
We furthermore include the header file of the optimization definition
class called <spa!n class=TT>Opt</span>.</span></p>

<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>#include "OFELI.h"
#include "Opt.h"
#include "User.h"
using namespace OFELI;</font></pre></span>
</td></tr></table>
</span></p>

<li><SPAN class=TEXT>The program will have as argument the name of the parameter data file:
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>int main(int argc, char *argv[])
{</font></pre>
</td></tr></table>
</span></p>

<li><SPAN class=TEXT>We expand program arguments and declare an instance of class <a href="../html/classOFELI_1_1IPF.html">IPF</a> for parameter
file:</p>
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   if (argc &lt;= 1) {
      cout &lt;&lt; " Usage: lesson5 &lt;parameter_file&gt;" &lt;&lt; endl;
      exit(1)
   }
   IPF data(argv[1]);</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>The mesh data file is obtained from a member function of instance <span class=TT>data</span>.
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   Mesh ms(data.getMeshFile());</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>We introduce boundary conditions through a user defined class (See <a href="lesson4.html">Lesson 4</a>).
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   User ud(ms);</font></pre>
</td></tr></table></p>
<p>Implementation of class <span class=TT>User</span> will be given later.</span></p>

<li><span class=TEXT><span class=TT>n</span> is the number of degrees of freedom.
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   int n = ms.getNbDOF();</font></pre>
</td></tr></table></p>

<li><span class=TEXT>We declare some vectors. <span class=var>x</span> is the solution vector, vectors <span class=TT>low</span>
and <span class=TT>up</span> will contain for each degree of freedom upper and lower bound respectively to prescribe and
<span class=TT>pivot</span> is a vector that will contains (after optimization) flags to indicate which constraint is
reached.
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   Vect&lt;double&gt; x(n),low(n),up(n);
   Vect&lt;int&gt; pivot(n);</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>Dirichlet boundary conditions are taken into account as before :
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   Vect&lt;double&gt; bc(n);
   ud.setDBC(bc);</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>We start now to properly define the optimization problem. For this, we declare an instance of
a class <span class=TT>Opt</span> that is defined separately. The constructor of this class invokes the mesh instance
and the instance <span class=TT>ud</span> that will be useful to transmit to the class body or boundary sources.
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   Opt theOpt(ms,ud);</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>We also initialize the solution to zero :
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   x = 0;</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>As said before, Dirichlet boundary conditions are considered here as equality constraints and are
then incorporated into vectors low and up via a utility function called <span class=TT>BCAsConstraint</span> contained in the
mentioned file <span class=TT>OptimAux.h</span>
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   BCAsConstraint(ms,bc,up,low);</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>The function <span class=TT><a href="../html/OptimTN_8h.html">OptimTN</a></span> can now be invoked to run the optimization algorithm.
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   OptimTN&lt;Opt&gt;(theOpt,x,low,up,pivot,100,1.e-12,1);</font></pre>
</td></tr></table></p>
<p>The reader can refer to the function <span class=TT><a href="../html/OptimTN_8h.html">OptimTN</a></span> to
understand the meaning of each argument of the function.</span>

<li><span class=TEXT>If the algorithm has succeeded (which is the case in this example) we can output the solution
and close the program.
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   cout &lt;&lt; "\nSolution :\n" &lt;&lt; x;
}</font></pre>
</td></tr></table>
</span>
</ul><br>

<h4><font color="red">A User defined class</font></h4>

<span class=text>We have now to implement class <span class=TT>Opt</span> that defines the problem to solve and
provides to the objective function and its gradient. The class is defined in file <span class=TT>Opt.h</span>
that we study here below.</span>

<ul type="square">
<li><span class=TEXT>We start by including files <span class=TT>OFELI.h</span> and <span class=TT>Therm.h</span>
since we are going to solve a heat transfer problem. We also invoke the namespace <span class=TT>OFELI</span>:
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>#include "OFELI.h"
#include "Therm.h"
#include "User.h"
using namespace OFELI;</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>This class will have a constructor that acquires the mesh and the user data instance and stores
pointers to these objects:
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>class Opt {

public:
   Opt(Mesh &ms, User &ud) { _ms = &ms; _ud = &ud; }</font></pre>
</td></tr></table>
</span></p>

<li><span class=TEXT>The other public member is the objective function.
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>   void Objective(Vect&lt;double&gt; &x, double &f, Vect&lt;double&gt; &g) {
        f = 0.;
        g = 0.;
        MeshElements(*_ms) {
           DC2DT3 eq(theElement);
           Vect&lt;double&gt; xe(theElement,x);
           f += eq.Energy(xe);
           eq.EnerGrad(xe);
           eq.ElementAssembly(g);
        }
   }</font></pre>
</td></tr></table></p>
<p>Note that the arguments of the objective function are necessarily the optimization variable vector, the objective
function to compute and the gradient vector to compute. Here the class <a href="../html/classOFELI_1_1DC2DT3.html">DC2DT3</a>
provides necessary material for optimization purposes. Namely, member function <span class=TT>Energy</span>
return the energy value and function <span class=TT>EnerGrad</span> calculates the element energy gradient that
needs be assembled into the global vector <span class=TT>g</span>.</span>
<li><span class=TEXT>It remains to declare the mesh and user data pointers as private attributes of the class and end the class definition.
<p><table bgcolor="#e0f8f7" border="1" frame=box rules=none width=700>
<tr><td>
<pre><font color="blue" size=3>private:
   Mesh *_ms;
   User *_ud;
};</font></pre>
</td></tr></table>
</span>
</ul>
<br>

<p class=EL>A test</p>

<p><SPAN class=TEXT>We use here exactly the same mesh file as in the previous lesson. Of course, we obtain the same
solution as the previous lesson. The output of the program is the following:</span>

<pre><font color="#800080" size=3>

   NIT  NF   CG           F                  GTG

    0    1    0     6.00000000e+000     4.00000000e+001
    1    2    3     1.67852990e+000     4.09059524e+001
    2    3    5     1.50042385e+000     4.09106651e+001
    3    4    8     1.50001179e+000     4.09109024e+001
    4    5   10     1.50000062e+000     4.09109074e+001
    5    6   13     1.50000000e+000     4.09109074e+001
    6    7   15     1.50000000e+000     4.09109074e+001
    7    8   17     1.50000000e+000     4.09109074e+001
    8    9   19     1.50000000e+000     4.09109074e+001


Optimal Function Value = 1.5

Solution :
     1     1.00000000e+000
     2     7.49999986e-001
     3     4.99999972e-001
     4     2.49999994e-001
     5     0.00000000e+000
     6     1.00000000e+000
     7     7.49999988e-001
     8     4.99999982e-001
     9     2.49999978e-001
    10     0.00000000e+000
    11     1.00000000e+000
    12     7.49999989e-001
    13     4.99999982e-001
    14     2.49999978e-001
    15     0.00000000e+000
    16     1.00000000e+000
    17     7.49999986e-001
    18     4.99999972e-001
    19     2.49999994e-001
    20     0.00000000e+000</font></pre>

<p><table align="center" border="2" cellpadding="2" cellspacing="0" >
<tr>
<td align="center" width="35"><a href="lesson4.html"><img src="../im/backward.gif" border="0"></a></td>
<td align="center" width="35"><a href="../tutorial.html"><img src="../im/top.gif" border="0"></a></td>
<td align="center" width="35"><a href="lesson6.html"><img src="../im/forward.gif" border="0"></a></td>
</tr>
</table>

&nbsp;
<div id="foot_bar">
        Copyright &copy; 1998-2016 Rachid Touzani&nbsp;
</div>

</body>
</html>
